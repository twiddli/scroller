/*! 
 * @twiddly/scroller v1.1.0
 * Homepage: https://github.com/twiddli/scroller#readme
 * Released under the MIT License.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Scroller=i()}(this,(function(){"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function e(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}var s=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame,i=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(i=!1),i)return function(i,e){t(i,e)};var e={},s=1,o=null,_=+new Date;return function(t){var i=s++;return e[i]=t,null===o&&(o=setInterval((function(){var t=+new Date,i=e;for(var s in e={},i)i.hasOwnProperty(s)&&(i[s](t),_=t);t-_>2500&&(clearInterval(o),o=null)}),1e3/60)),i}}(),o=Date.now||function(){return+new Date},_=function(){function i(){t(this,i),this.running={},this.counter=1}return e(i,[{key:"stop",value:function(t){var i=null!==this.running[t];return i&&(this.running[t]=null),i}},{key:"isRunning",value:function(t){return null!==this.running[t]}},{key:"start",value:function(t,i,e,_,n,l){var h=this,r=o(),a=r,c=0,p=0,u=this.counter++;if(l||(l=document.body),u%20==0){var f={};for(var m in this.running)f[m]=!0;this.running=f}return this.running[u]=!0,s((function f(m){var g=!0!==m,v=o();if(!h.running[u]||i&&!i(u))return h.running[u]=null,void(e&&e(60-p/((v-r)/1e3),u,!1));if(g)for(var d=Math.round((v-a)/(1e3/60))-1,T=0;T<Math.min(d,4);T++)f(!0),p++;_&&(c=(v-r)/_)>1&&(c=1);var L=n?n(c):c;!1!==t(L,v,g)&&1!==c||!g?g&&(a=v,s(f,l)):(h.running[u]=null,e&&e(60-p/((v-r)/1e3),u,1===c||null==_))}),l),u}}]),i}(),n=function(t){return Math.pow(t-1,3)+1},l=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},h=function(){};return function(){function i(e,s){for(var o in t(this,i),this.animate=new _,this.__callback=e,this.options={scrollingX:!0,scrollingY:!0,centering:!1,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:h,penetrationDeceleration:.03,penetrationAcceleration:.08},s)s.hasOwnProperty(o)&&(this.options[o]=s[o]);this.__isSingleTouch=!1,this.__isTracking=!1,this.__didDecelerationComplete=!1,this.__isGesturing=!1,this.__isDragging=!1,this.__isDecelerating=!1,this.__isAnimating=!1,this.__clientLeft=0,this.__clientTop=0,this.__clientWidth=0,this.__clientHeight=0,this.__contentWidth=0,this.__contentHeight=0,this.__snapWidth=100,this.__snapHeight=100,this.__refreshHeight=null,this.__refreshActive=!1,this.__refreshActivate=null,this.__refreshDeactivate=null,this.__refreshStart=null,this.__zoomLevel=1,this.__scrollLeft=0,this.__scrollTop=0,this.__maxScrollLeft=0,this.__maxScrollTop=0,this.__scheduledLeft=0,this.__scheduledTop=0,this.__scheduledZoom=0,this.__leftOffset=0,this.__topOffset=0,this.__lastTouchLeft=null,this.__lastTouchTop=null,this.__lastTouchMove=null,this.__positions=[],this.__minDecelerationScrollLeft=null,this.__minDecelerationScrollTop=null,this.__maxDecelerationScrollLeft=null,this.__maxDecelerationScrollTop=null,this.__decelerationVelocityX=null,this.__decelerationVelocityY=null}return e(i,[{key:"setDimensions",value:function(t,i,e,s){t===+t&&(this.__clientWidth=t),i===+i&&(this.__clientHeight=i),e===+e&&(this.__contentWidth=e),s===+s&&(this.__contentHeight=s),this.__computeScrollMax(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)}},{key:"setPosition",value:function(t,i){this.__clientLeft=t||0,this.__clientTop=i||0}},{key:"setSnapSize",value:function(t,i){this.__snapWidth=t,this.__snapHeight=i}},{key:"activatePullToRefresh",value:function(t,i,e,s){this.__refreshHeight=t,this.__refreshActivate=i,this.__refreshDeactivate=e,this.__refreshStart=s}},{key:"triggerPullToRefresh",value:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()}},{key:"finishPullToRefresh",value:function(){this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)}},{key:"getValues",value:function(){return{left:this.__scrollLeft-(this.options.centering?this.__leftOffset:0),top:this.__scrollTop-(this.options.centering?this.__topOffset:0),zoom:this.__zoomLevel}}},{key:"getScrollMax",value:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}}},{key:"zoomTo",value:function(t,i,e,s,o){if(!this.options.zooming)throw new Error("Zooming is not enabled!");o&&(this.__zoomComplete=o),this.__isDecelerating&&(this.animate.stop(this.__isDecelerating),this.__isDecelerating=!1);var _=this.__zoomLevel;null==e&&(e=this.__clientWidth/2),null==s&&(s=this.__clientHeight/2),t=Math.max(Math.min(t,this.options.maxZoom),this.options.minZoom),this.__computeScrollMax(t);var n=(e+this.__scrollLeft)*t/_-e,l=(s+this.__scrollTop)*t/_-s;n>this.__maxScrollLeft?n=this.__maxScrollLeft:n<0&&(n=0),l>this.__maxScrollTop?l=this.__maxScrollTop:l<0&&(l=0),this.__publish(n,l,t,i)}},{key:"zoomBy",value:function(t,i,e,s,o){this.zoomTo(this.__zoomLevel*t,i,e,s,o)}},{key:"scrollTo",value:function(t,i,e,s){if(this.__isDecelerating&&(this.animate.stop(this.__isDecelerating),this.__isDecelerating=!1),null!=s&&s!==this.__zoomLevel){if(!this.options.zooming)throw new Error("Zooming is not enabled!");t*=s,i*=s,this.__computeScrollMax(s)}else s=this.__zoomLevel;this.options.scrollingX?this.options.paging?t=Math.round(t/this.__clientWidth)*this.__clientWidth:this.options.snapping&&(t=Math.round(t/this.__snapWidth)*this.__snapWidth):t=this.__scrollLeft,this.options.scrollingY?this.options.paging?i=Math.round(i/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(i=Math.round(i/this.__snapHeight)*this.__snapHeight):i=this.__scrollTop,t=Math.max(Math.min(this.__maxScrollLeft,t),0),i=Math.max(Math.min(this.__maxScrollTop,i),0),t===this.__scrollLeft&&i===this.__scrollTop&&(e=!1),this.__isTracking||this.__publish(t,i,s,e)}},{key:"scrollBy",value:function(t,i,e){var s=this.__isAnimating?this.__scheduledLeft:this.__scrollLeft,o=this.__isAnimating?this.__scheduledTop:this.__scrollTop;this.scrollTo(s+(t||0),o+(i||0),e)}},{key:"doMouseZoom",value:function(t,i,e,s){var o=t>0?.97:1.03;return this.zoomTo(this.__zoomLevel*o,!1,e-this.__clientLeft,s-this.__clientTop)}},{key:"doTouchStart",value:function(t,i){if(null==t.length)throw new Error("Invalid touch list: ".concat(t));if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: ".concat(i));var e,s;this.__interruptedAnimation=!0,this.__isDecelerating&&(this.animate.stop(this.__isDecelerating),this.__isDecelerating=!1,this.__interruptedAnimation=!0),this.__isAnimating&&(this.animate.stop(this.__isAnimating),this.__isAnimating=!1,this.__interruptedAnimation=!0);var o=1===t.length;o?(e=t[0].pageX,s=t[0].pageY):(e=Math.abs(t[0].pageX+t[1].pageX)/2,s=Math.abs(t[0].pageY+t[1].pageY)/2),this.__initialTouchLeft=e,this.__initialTouchTop=s,this.__zoomLevelStart=this.__zoomLevel,this.__lastTouchLeft=e,this.__lastTouchTop=s,this.__lastTouchMove=i,this.__lastScale=1,this.__enableScrollX=!o&&this.options.scrollingX,this.__enableScrollY=!o&&this.options.scrollingY,this.__isTracking=!0,this.__didDecelerationComplete=!1,this.__isDragging=!o,this.__isSingleTouch=o,this.__positions=[]}},{key:"doTouchMove",value:function(t,i,e){if(null==t.length)throw new Error("Invalid touch list: ".concat(t));if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: ".concat(i));if(this.__isTracking){var s,o;2===t.length?(s=Math.abs(t[0].pageX+t[1].pageX)/2,o=Math.abs(t[0].pageY+t[1].pageY)/2):(s=t[0].pageX,o=t[0].pageY);var _=this.__positions;if(this.__isDragging){var n=s-this.__lastTouchLeft,l=o-this.__lastTouchTop,h=this.__scrollLeft,r=this.__scrollTop,a=this.__zoomLevel;if(null!=e&&this.options.zooming){var c=a;if(a=a/this.__lastScale*e,c!==(a=Math.max(Math.min(a,this.options.maxZoom),this.options.minZoom))){var p=s-this.__clientLeft,u=o-this.__clientTop;h=(p+h)*a/c-p,r=(u+r)*a/c-u,this.__computeScrollMax(a)}}if(this.__enableScrollX){h-=n*this.options.speedMultiplier;var f=this.__maxScrollLeft;(h>f||h<0)&&(this.options.bouncing?h+=n/2*this.options.speedMultiplier:h=h>f?f:0)}if(this.__enableScrollY){r-=l*this.options.speedMultiplier;var m=this.__maxScrollTop;(r>m||r<0)&&(this.options.bouncing?(r+=l/2*this.options.speedMultiplier,this.__enableScrollX||null==this.__refreshHeight||(!this.__refreshActive&&r<=-this.__refreshHeight?(this.__refreshActive=!0,this.__refreshActivate&&this.__refreshActivate()):this.__refreshActive&&r>-this.__refreshHeight&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate()))):r=r>m?m:0)}_.length>60&&_.splice(0,30),_.push(h,r,i),this.__publish(h,r,a)}else{var g=this.options.locking?3:0,v=Math.abs(s-this.__initialTouchLeft),d=Math.abs(o-this.__initialTouchTop);this.__enableScrollX=this.options.scrollingX&&v>=g,this.__enableScrollY=this.options.scrollingY&&d>=g,_.push(this.__scrollLeft,this.__scrollTop,i),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(v>=5||d>=5),this.__isDragging&&(this.__interruptedAnimation=!1)}this.__lastTouchLeft=s,this.__lastTouchTop=o,this.__lastTouchMove=i,this.__lastScale=e}}},{key:"doTouchEnd",value:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: ".concat(t));if(this.__isTracking){if(this.__isTracking=!1,this.__isDragging)if(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&t-this.__lastTouchMove<=100){for(var i=this.__positions.length-1,e=i,s=i;s>0&&this.__positions[s]>this.__lastTouchMove-100;s-=3)e=s;if(e!==i){var o=this.__positions[i]-this.__positions[e],_=this.__scrollLeft-this.__positions[e-2],n=this.__scrollTop-this.__positions[e-1];this.__decelerationVelocityX=_/o*(1e3/60),this.__decelerationVelocityY=n/o*(1e3/60);var l=this.options.paging||this.options.snapping?4:1;Math.abs(this.__decelerationVelocityX)>l||Math.abs(this.__decelerationVelocityY)>l?this.__refreshActive||this.__startDeceleration(t):this.options.scrollingComplete()}else this.options.scrollingComplete()}else t-this.__lastTouchMove>100&&this.options.scrollingComplete();this.__isDecelerating||(this.__refreshActive&&this.__refreshStart?(this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()):((this.__interruptedAnimation||this.__isDragging)&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel),this.__refreshActive&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate()))),this.__positions.length=0}}},{key:"__publish",value:function(t,i,e,s){var o=this,_=this.__isAnimating;if(_&&(this.animate.stop(_),this.__isAnimating=!1),s&&this.options.animating){this.__scheduledLeft=t,this.__scheduledTop=i,this.__scheduledZoom=e;var h=this.__scrollLeft,r=this.__scrollTop,a=this.__zoomLevel,c=t-h,p=i-r,u=e-a;this.__isAnimating=this.animate.start((function(t,i,e){e&&(o.__scrollLeft=h+c*t,o.__scrollTop=r+p*t,o.__zoomLevel=a+u*t,o.__callback&&o.__callback(o.__scrollLeft-o.__leftOffset,o.__scrollTop-o.__topOffset,o.__zoomLevel))}),(function(t){return o.__isAnimating===t}),(function(t,i,e){i===o.__isAnimating&&(o.__isAnimating=!1),(o.__didDecelerationComplete||e)&&o.options.scrollingComplete(),o.options.zooming&&(o.__computeScrollMax(),o.__zoomComplete&&(o.__zoomComplete(),o.__zoomComplete=null))}),this.options.animationDuration,_?n:l)}else this.__scheduledLeft=this.__scrollLeft=t,this.__scheduledTop=this.__scrollTop=i,this.__scheduledZoom=this.__zoomLevel=e,this.__callback&&self.__callback(t-this.__leftOffset,i-this.__topOffset,e),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))}},{key:"__computeScrollMax",value:function(t){null==t&&(t=this.__zoomLevel),this.__maxScrollLeft=Math.max(this.__contentWidth*t-this.__clientWidth,0),this.__maxScrollTop=Math.max(this.__contentHeight*t-this.__clientHeight,0);var i=0,e=0;this.options.centering&&(i=this.__clientWidth>this.__contentWidth*this.__zoomLevel?(this.__clientWidth-this.__contentWidth*this.__zoomLevel)/2:0,e=this.__clientHeight>this.__contentHeight*this.__zoomLevel?(this.__clientHeight-this.__contentHeight*this.__zoomLevel)/2:0),this.__leftOffset=i,this.__topOffset=e}},{key:"__startDeceleration",value:function(){var t=this;if(this.options.paging){var i=Math.max(Math.min(this.__scrollLeft,this.__maxScrollLeft),0),e=Math.max(Math.min(this.__scrollTop,this.__maxScrollTop),0),s=this.__clientWidth,o=this.__clientHeight;this.__minDecelerationScrollLeft=Math.floor(i/s)*s,this.__minDecelerationScrollTop=Math.floor(e/o)*o,this.__maxDecelerationScrollLeft=Math.ceil(i/s)*s,this.__maxDecelerationScrollTop=Math.ceil(e/o)*o}else this.__minDecelerationScrollLeft=0,this.__minDecelerationScrollTop=0,this.__maxDecelerationScrollLeft=this.__maxScrollLeft,this.__maxDecelerationScrollTop=this.__maxScrollTop;var _=this.options.snapping?4:.001;this.__isDecelerating=this.animate.start((function(i,e,s){return t.__stepThroughDeceleration(s)}),(function(){var i=Math.abs(t.__decelerationVelocityX)>=_||Math.abs(t.__decelerationVelocityY)>=_;return i||(t.__didDecelerationComplete=!0),i}),(function(){t.__isDecelerating=!1,t.__didDecelerationComplete&&t.options.scrollingComplete(),t.scrollTo(t.__scrollLeft,t.__scrollTop,t.options.snapping)}))}},{key:"__stepThroughDeceleration",value:function(t){var i=this.__scrollLeft+this.__decelerationVelocityX,e=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var s=Math.max(Math.min(this.__maxDecelerationScrollLeft,i),this.__minDecelerationScrollLeft);s!==i&&(i=s,this.__decelerationVelocityX=0);var o=Math.max(Math.min(this.__maxDecelerationScrollTop,e),this.__minDecelerationScrollTop);o!==e&&(e=o,this.__decelerationVelocityY=0)}if(t?this.__publish(i,e,this.__zoomLevel):(this.__scrollLeft=i,this.__scrollTop=e),!this.options.paging){this.__decelerationVelocityX*=.95,this.__decelerationVelocityY*=.95}if(this.options.bouncing){var _=0,n=0,l=this.options,h=l.penetrationDeceleration,r=l.penetrationAcceleration;i<this.__minDecelerationScrollLeft?_=this.__minDecelerationScrollLeft-i:i>this.__maxDecelerationScrollLeft&&(_=this.__maxDecelerationScrollLeft-i),e<this.__minDecelerationScrollTop?n=this.__minDecelerationScrollTop-e:e>this.__maxDecelerationScrollTop&&(n=this.__maxDecelerationScrollTop-e),0!==_&&(_*this.__decelerationVelocityX<=0?this.__decelerationVelocityX+=_*h:this.__decelerationVelocityX=_*r),0!==n&&(n*this.__decelerationVelocityY<=0?this.__decelerationVelocityY+=n*h:this.__decelerationVelocityY=n*r)}}}]),i}()}));
